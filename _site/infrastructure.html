<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="CoSciN : The Cornell Science Network">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>CoSciN</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/coscin/website">View on GitHub</a>

          <h1 id="project_title"><a href="/"><img src="images/coscin_small_logo.png"/></a></h1>
          <h2 id="project_tagline">The Cornell Science Network</h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2 id="creating-a-controller">Creating a Controller</h2>

<blockquote>
  <p>Note: Yahoo-supplied 1U servers work fine as controllers.  If you use one, make sure you disable the IPMI 
Watchdog timer in BIOS.  Otherwise your server will spontaneously reboot in the middle of installation or running (and
it’s really confusing to debug!)</p>
</blockquote>

<ol>
  <li>
    <p>Install Ubuntu Server 14.04 from a USB stick.  There is an Ubuntu 14.04 USB stick expressly for this purpose. 
Accept the defaults, except be sure to install OpenSSH Server when prompted.  (If you forget, you can 
always install the APT package “openssh-server” in step 2 below.)</p>
  </li>
  <li>
    <p>Make sure the IP address is properly set statically (/etc/network/interfaces) or by DHCP.  CIT and Weill
Medical Network staffs control the production IP addresses.  For the test network in Gates, Emin Gun-Sirer 
(egs@systems.cs.cornell.edu) is the administrator of DHCP-supplied IP addresses in the SysLab, and this is the 
preferred method of configuration for “permanent” hosted machines.  Either way, you want to make sure the
IP is more-or-less permanently leased, since the switches depend on communicating with controllers at a 
particular address.</p>
  </li>
  <li>
    <p>Install supporting software</p>

    <p><code class="highlighter-rouge">
  you@coscin-ctrl-timbuktu ~$ sudo apt-get update
  you@coscin-ctrl-timbuktu ~$ sudo apt-get install python-pip python-dev git
 </code></p>
  </li>
  <li>
    <p>If this will be a zookeeper node, install zookeeper as a daemon (generally only one controller host per switch needs
to run Zookeeper).</p>

    <p><code class="highlighter-rouge">
you@coscin-ctrl-timbuktu ~$ sudo apt-get install zookeeper zookeeperd
</code></p>
  </li>
  <li>
    <p>Install Python packages.  You can ignore warnings when installing the <code class="highlighter-rouge">six</code> package.</p>

    <p><code class="highlighter-rouge">
you@coscin-ctrl-timbuktu$ sudo pip install ryu kazoo
you@coscin-ctrl-timbuktu$ sudo pip install six --upgrade
</code></p>
  </li>
  <li>
    <p>Add a <code class="highlighter-rouge">frenetic</code> user to run the controller software:</p>

    <p><code class="highlighter-rouge">
you@coscin-ctrl-timbuktu ~$ sudo adduser frenetic
</code></p>
  </li>
  <li>
    <p>Install the Coscin Controller software under the <code class="highlighter-rouge">frenetic</code> user</p>

    <p><code class="highlighter-rouge">
you@coscin-ctrl-timbuktu ~$ sudo -i -u frenetic
frenetic@coscin-ctrl-timbuktu ~$ mkdir src
frenetic@coscin-ctrl-timbuktu ~$ cd src
frenetic@coscin-ctrl-timbuktu ~/src$ git clone https://github.com/coscin/coscin-app-ryu
frenetic@coscin-ctrl-timbuktu ~/src$ exit
</code></p>
  </li>
  <li>
    <p>Install the Upstart script for coscin-app-ryu</p>

    <p><code class="highlighter-rouge">
you@coscin-ctrl-timbuktu ~$ sudo install ~frenetic/src/coscin-app-ryu/coscin-app-ryu.conf /etc/init
</code></p>

    <p>The coscin-app-ryu.conf file is configured to use <code class="highlighter-rouge">~frenetic/src/coscin-app-ryu/coscin_gates_testbed.conf</code> as its
configuration file.  If you want to use another configuration file, like <code class="highlighter-rouge">coscin_production.conf</code>, you can change
it in this file (e.g. <code class="highlighter-rouge">sudo nano /etc/init/coscin-app-ryu.conf</code>)</p>
  </li>
  <li>
    <p>Make sure the Coscin configuration file is correct.  See the next section for details.</p>
  </li>
  <li>
    <p>Start up the controller.</p>

    <p><code class="highlighter-rouge">
you@coscin-ctrl-timbuktu ~$ sudo service coscin-app-ryu start
</code></p>
  </li>
  <li>
    <p>Check the log file <code class="highlighter-rouge">/var/log/upstart/coscin-app-ryu.log</code> for problems.  Common ones are:</p>

    <ul>
      <li>
        <p>You’re not getting a backup controller message.  That means your switch is not communcating to this controller.
On an HP 5406l switch, you want to make sure the running configuration has the proper controller IP address
recorded.</p>
      </li>
      <li>
        <p>The controller software is waiting as a backup controller.  That means there’s another controller online and
it’s the master.  That’s fine.  If you want to test this for backup status, you can shut down the controller.
This one should immediately be promoted to master.</p>
      </li>
      <li>
        <p>If you get a “Index NONE Not found” that usually means the switch is communicating a DPID (datapath ID, usuaully
the Mac address prepended with an OpenFlow slice identifier).  In this case, you should see the DPID line
a few log messages above.  Check your configuration file to make sure the proper DPID is listed.</p>
      </li>
    </ul>
  </li>
</ol>

<h2 id="the-coscin-configuration-file">The CoSciN Configuration File</h2>

<p>The CoSciN controller reads its configuration from a JSON-formatted file. Here’s the one used for the Gates hall Testbed:</p>

<p><code class="highlighter-rouge"><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nt">"ithaca"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"dpid"</span><span class="p">:</span><span class="w"> </span><span class="mi">378372418415616</span><span class="p">,</span><span class="w">
    </span><span class="nt">"network"</span><span class="p">:</span><span class="w"> </span><span class="s2">"192.168.56.0/24"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"vlan"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"controller_hosts"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"coscintest-ctrl-ithaca1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"coscintest-ctrl-ithaca2"</span><span class="p">],</span><span class="w">
    </span><span class="nt">"zookeeper"</span><span class="p">:</span><span class="w"> </span><span class="s2">"coscintest-ctrl-ithaca1:2181"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"nyc"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"dpid"</span><span class="p">:</span><span class="w"> </span><span class="mi">378372418241536</span><span class="p">,</span><span class="w">
    </span><span class="nt">"network"</span><span class="p">:</span><span class="w"> </span><span class="s2">"192.168.57.0/24"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"vlan"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"controller_hosts"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"coscintest-ctrl-nyc1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"coscintest-ctrl-nyc2"</span><span class="p">],</span><span class="w">
    </span><span class="nt">"zookeeper"</span><span class="p">:</span><span class="w"> </span><span class="s2">"coscintest-ctrl-nyc1:2181"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"alternate_paths"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nt">"ithaca"</span><span class="p">:</span><span class="w"> </span><span class="s2">"192.168.156.0/24"</span><span class="p">,</span><span class="w"> </span><span class="nt">"nyc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"192.168.157.0/24"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nt">"ithaca"</span><span class="p">:</span><span class="w"> </span><span class="s2">"192.168.158.0/24"</span><span class="p">,</span><span class="w"> </span><span class="nt">"nyc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"192.168.159.0/24"</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w"> </span><span class="nt">"ithaca"</span><span class="p">:</span><span class="w"> </span><span class="s2">"192.168.160.0/24"</span><span class="p">,</span><span class="w"> </span><span class="nt">"nyc"</span><span class="p">:</span><span class="w"> </span><span class="s2">"192.168.161.0/24"</span><span class="w"> </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></p>

<p>There are two “sides” to the CoSciN network labelled <code class="highlighter-rouge">ithaca</code> and <code class="highlighter-rouge">nyc</code> (although in the Gates testbed, both of these
sides are in Gates 440).  The parameters are:</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">dpid</code> gives the datapath ID for the switch.  Every switch has a different one, usually composed of the switches MAC 
address prepended with an OpenFlow slice ID.  Since the number here needs to be decimal, it’s usually easiest to bring
up the controller, which will report the DPID in the log as an integer.  The controller itself will error out if the
dpid in the configu file doesn’t match.  But you can then copy-and-paste the DPID from the log to the config file and restart it.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">network</code> is the real network continaing the measurement server and hosts in CIDR format.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">vlan</code> is the VLAN id of the OpenFlow slice on the switch.  Usually we use 1 because it’s the default.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">controller_hosts</code> is an array of all the controller names for this side of the network.  One of these should match the
hostname recorded in /etc/hostname on Ubuntu.  (DNS names may be different, but these aren’t consulted here).</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">zookeeper</code> is the DNS host name and port for the Zookeeper server.  There is only one per side.  Default port here is 2181,
and the host name should be pingable from all controllers (so it should be in DNS, or in every hosts’ /etc/hosts file).</p>
  </li>
  <li>
    <p>The <code class="highlighter-rouge">alternate_paths</code> structure defines imaginary networks that will define the route.  There may be one or more here.</p>
  </li>
</ul>

<blockquote>
  <p>Note: The subnet sizes for each network and alternate paths <em>for the same side of the network</em> must match.  However, the subnet
sizes can differ <em>between</em> the sides - you can have 1024 hosts on the Ithaca side and 2 on the NYC side and things will be
just fine.  But all the Ithaca subnet sizes should be 1024 in this case.</p>
</blockquote>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">CoSciN maintained by <a href="https://github.com/coscin">coscin</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
